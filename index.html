<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¨ãƒ«ãƒœ å»ºå›½ã‚µãƒ¼ãƒãƒ¼ | é‹å–¶å‹Ÿé›†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">

  <!-- reCAPTCHA v2 -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>

<header>
  <h1>ã‚¨ãƒ«ãƒœ å»ºå›½ã‚µãƒ¼ãƒãƒ¼</h1>
  <p>Minecraft çµ±åˆç‰ˆ å»ºå›½ã‚µãƒ¼ãƒãƒ¼</p>
</header>

<section class="intro">
  <h2>é‹å–¶ãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†</h2>
  <p>
    ã‚¨ãƒ«ãƒœã¯å»ºå›½ãƒ»çµŒæ¸ˆãƒ»æˆ¦äº‰ã‚’ãƒ†ãƒ¼ãƒã«ã—ãŸ  
    ãƒã‚¤ãƒ³ã‚¯ãƒ©ãƒ•ãƒˆçµ±åˆç‰ˆã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚  
    ä¸€ç·’ã«é‹å–¶ã—ã¦ãã‚Œã‚‹ä»²é–“ã‚’å‹Ÿé›†ã—ã¦ã„ã¾ã™ï¼
  </p>
</section>

<section class="roles">
  <h2>é‹å–¶å½¹è·</h2>
  <div class="card"><h3>Staff</h3><p>ãƒ­ãƒ¼ãƒ«ç®¡ç†ãƒ»æ‹›å¾…ç®¡ç†ãƒ»æ¡ˆå†…</p></div>
  <div class="card"><h3>Helper</h3><p>ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆãƒ»ãƒ­ãƒ¼ãƒ«ç®¡ç†ãƒ»æ¡ˆå†…</p></div>
  <div class="card"><h3>Guide</h3><p>ã‚­ãƒƒã‚¯æ¨©é™ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ</p></div>
  <div class="card"><h3>Moderater</h3><p>ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ãƒ»Botè¿½åŠ </p></div>
</section>

<section class="special">
  <h2>ã‚¬ã‚¤ãƒ‰ä»¥ä¸Š</h2>
  <div class="card gold"><h3>Designer</h3><p>å‹•ç”»ãƒ»ç”»åƒåˆ¶ä½œ</p></div>
  <div class="card gold"><h3>Produce</h3><p>ã‚¢ãƒ‰ã‚ªãƒ³åˆ¶ä½œ</p></div>
  <div class="card red"><h3>Developer</h3><p>BOTãƒ»ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†</p></div>
</section>

<section class="apply">
  <h2>å¿œå‹Ÿãƒ•ã‚©ãƒ¼ãƒ </h2>

  <form id="applyForm">
    <input type="text" id="name" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" required>
    <input type="text" id="discord" placeholder="Discordå" required>
    <input type="number" id="age" placeholder="å¹´é½¢" required>

    <select id="role" required>
      <option value="">å¸Œæœ›å½¹è·</option>
      <option>Staff</option>
      <option>Helper</option>
      <option>Guide</option>
      <option>Moderater</option>
      <option>Designer</option>
      <option>Produce</option>
      <option>Developer</option>
    </select>

    <textarea id="reason" placeholder="å¿—æœ›ç†ç”±" required></textarea>

    <!-- reCAPTCHAï¼ˆã‚µã‚¤ãƒˆã‚­ãƒ¼ã«ç½®ãæ›ãˆï¼‰ -->
    <div class="g-recaptcha" data-sitekey="6LdTtVssAAAAAJI2pM9fWX6m2LXYDaAZl9DojTMp"></div>

    <button type="submit">å¿œå‹Ÿã™ã‚‹</button>
  </form>

  <p id="result"></p>

  <!-- é€ä¿¡ãƒ­ã‚° -->
  <div id="logBox">
    <h3>é€ä¿¡ãƒ­ã‚°ï¼ˆã“ã®ç«¯æœ«ï¼‰</h3>
    <ul id="logList"></ul>
  </div>
</section>

<footer>
  <p>Â© Erbo Server</p>
</footer>

<script>
const webhookURL  = "https://discord.com/api/webhooks/1466921440770003146/8ya1FjS4fNRtSPMGHuN7hjTDcQReNcWCpWqvquIxgwgIyj_NXRbP6e7OgaP5eDzZgAx9";
const formspreeURL = "https://formspree.io/f/mjgrlwvo";

const form = document.getElementById("applyForm");
const result = document.getElementById("result");
const logList = document.getElementById("logList");

const nameInput = document.getElementById("name");
const discordInput = document.getElementById("discord");
const ageInput = document.getElementById("age");
const roleInput = document.getElementById("role");
const reasonInput = document.getElementById("reason");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const token = grecaptcha.getResponse();
  if (!token) {
    alert("reCAPTCHAã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚");
    return;
  }

  const payload = {
    name: nameInput.value,
    discord: discordInput.value,
    age: ageInput.value,
    role: roleInput.value,
    reason: reasonInput.value,
    "g-recaptcha-response": token
  };

  try {
    // Discordé€ä¿¡
    const dres = await fetch(webhookURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        content: "ğŸ“© æ–°ã—ã„é‹å–¶å¿œå‹ŸãŒå±Šãã¾ã—ãŸï¼",
        embeds: [{
          title: "ã‚¨ãƒ«ãƒœ é‹å–¶å¿œå‹Ÿ",
          color: 3447003,
          fields: [
            { name: "åå‰", value: payload.name || "æœªå…¥åŠ›", inline: true },
            { name: "Discord", value: payload.discord || "æœªå…¥åŠ›", inline: true },
            { name: "å¹´é½¢", value: String(payload.age || "æœªå…¥åŠ›"), inline: true },
            { name: "å¸Œæœ›å½¹è·", value: payload.role || "æœªå…¥åŠ›", inline: true },
            { name: "å¿—æœ›ç†ç”±", value: payload.reason || "æœªå…¥åŠ›" }
          ],
          timestamp: new Date().toISOString()
        }]
      })
    });

    if (!dres.ok) throw new Error("Discordé€ä¿¡å¤±æ•—");

    // Formspreeé€ä¿¡
    const fres = await fetch(formspreeURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (!fres.ok) throw new Error("Formspreeé€ä¿¡å¤±æ•—");

    // ãƒ­ã‚°è¡¨ç¤º
    const li = document.createElement("li");
    li.textContent = `${new Date().toLocaleString()} - ${payload.name}ï¼ˆ${payload.role}ï¼‰`;
    logList.prepend(li);

    result.textContent = "å¿œå‹Ÿã‚’é€ä¿¡ã—ã¾ã—ãŸï¼";
    form.reset();
    grecaptcha.reset();

  } catch (err) {
    console.error(err);
    result.textContent = "é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚Webhookã‚„ã‚­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
  }
});
</script>


</body>
</html>
